.PHONY: help clone-all clone-pocketbase clone-gogen clone-presentator clone-jsonschema clone-goPocJson update-all update-pocketbase update-gogen update-presentator update-jsonschema update-goPocJson clean list status

## help: Show available make targets
help:
	@echo "Reference Code Management:"
	@echo ""
	@grep -E '^##' $(MAKEFILE_LIST) | sed 's/^## /  make /' | column -t -s ':'

.DEFAULT_GOAL := help

## clone-all: Clone all reference repositories at once
clone-all: clone-pocketbase clone-gogen clone-presentator clone-jsonschema clone-goPocJson

## clone-pocketbase: Clone PocketBase (official source for understanding record proxies)
clone-pocketbase:
	@echo "üì¶ Cloning PocketBase..."
	@if [ ! -d "pocketbase" ]; then \
		git clone https://github.com/pocketbase/pocketbase.git; \
		echo "‚úÖ PocketBase cloned"; \
	else \
		echo "‚ÑπÔ∏è  PocketBase already exists"; \
	fi

## clone-gogen: Clone pocketbase-gogen (type-safe code generator)
clone-gogen:
	@echo "üì¶ Cloning pocketbase-gogen..."
	@if [ ! -d "pocketbase-gogen" ]; then \
		git clone https://github.com/Snonky/pocketbase-gogen.git; \
		echo "‚úÖ pocketbase-gogen cloned"; \
	else \
		echo "‚ÑπÔ∏è  pocketbase-gogen already exists"; \
	fi

## clone-presentator: Clone Presentator (PocketBase library pattern example)
clone-presentator:
	@echo "üì¶ Cloning Presentator..."
	@if [ ! -d "presentator" ]; then \
		git clone https://github.com/presentator/presentator.git; \
		echo "‚úÖ Presentator cloned"; \
	else \
		echo "‚ÑπÔ∏è  Presentator already exists"; \
	fi

## clone-jsonschema: Clone jsonschema (validation library we use)
clone-jsonschema:
	@echo "üì¶ Cloning jsonschema..."
	@if [ ! -d "jsonschema" ]; then \
		git clone https://github.com/santhosh-tekuri/jsonschema.git; \
		echo "‚úÖ jsonschema cloned"; \
	else \
		echo "‚ÑπÔ∏è  jsonschema already exists"; \
	fi

## clone-goPocJson: Clone goPocJsonSchemaForm (dynamic form generation example)
clone-goPocJson:
	@echo "üì¶ Cloning goPocJsonSchemaForm..."
	@if [ ! -d "goPocJsonSchemaForm" ]; then \
		git clone https://github.com/warlockxins/goPocJsonSchemaForm.git; \
		echo "‚úÖ goPocJsonSchemaForm cloned"; \
	else \
		echo "‚ÑπÔ∏è  goPocJsonSchemaForm already exists"; \
	fi

## update-all: Update all repositories with git pull
update-all: update-pocketbase update-gogen update-presentator update-jsonschema update-goPocJson

## update-pocketbase: Update PocketBase repository
update-pocketbase:
	@if [ -d "pocketbase" ]; then \
		echo "‚¨áÔ∏è  Updating PocketBase..."; \
		cd pocketbase && git pull; \
		echo "‚úÖ PocketBase updated"; \
	else \
		echo "‚ùå PocketBase not found. Run: make clone-pocketbase"; \
	fi

## update-gogen: Update pocketbase-gogen repository
update-gogen:
	@if [ -d "pocketbase-gogen" ]; then \
		echo "‚¨áÔ∏è  Updating pocketbase-gogen..."; \
		cd pocketbase-gogen && git pull; \
		echo "‚úÖ pocketbase-gogen updated"; \
	else \
		echo "‚ùå pocketbase-gogen not found. Run: make clone-gogen"; \
	fi

## update-presentator: Update Presentator repository
update-presentator:
	@if [ -d "presentator" ]; then \
		echo "‚¨áÔ∏è  Updating Presentator..."; \
		cd presentator && git pull; \
		echo "‚úÖ Presentator updated"; \
	else \
		echo "‚ùå Presentator not found. Run: make clone-presentator"; \
	fi

## update-jsonschema: Update jsonschema repository
update-jsonschema:
	@if [ -d "jsonschema" ]; then \
		echo "‚¨áÔ∏è  Updating jsonschema..."; \
		cd jsonschema && git pull; \
		echo "‚úÖ jsonschema updated"; \
	else \
		echo "‚ùå jsonschema not found. Run: make clone-jsonschema"; \
	fi

## update-goPocJson: Update goPocJsonSchemaForm repository
update-goPocJson:
	@if [ -d "goPocJsonSchemaForm" ]; then \
		echo "‚¨áÔ∏è  Updating goPocJsonSchemaForm..."; \
		cd goPocJsonSchemaForm && git pull; \
		echo "‚úÖ goPocJsonSchemaForm updated"; \
	else \
		echo "‚ùå goPocJsonSchemaForm not found. Run: make clone-goPocJson"; \
	fi

## clean: Remove all cloned repositories (WARNING: destructive!)
clean:
	@echo "‚ö†Ô∏è  This will delete all cloned reference repositories"
	@read -p "Are you sure? [y/N]: " confirm; \
	if [ "$$confirm" = "y" ] || [ "$$confirm" = "Y" ]; then \
		rm -rf pocketbase pocketbase-gogen presentator jsonschema goPocJsonSchemaForm; \
		echo "‚úÖ All repositories removed"; \
	else \
		echo "‚ùå Cancelled"; \
	fi

## list: List which repositories are currently cloned
list:
	@echo "üìö Reference Repositories:"
	@echo ""
	@for dir in pocketbase pocketbase-gogen presentator jsonschema goPocJsonSchemaForm; do \
		if [ -d "$$dir" ]; then \
			echo "  ‚úÖ $$dir"; \
		else \
			echo "  ‚ùå $$dir (not cloned)"; \
		fi; \
	done

## status: Show git status and latest commit for all cloned repositories
status:
	@echo "üìä Repository Status:"
	@echo ""
	@for dir in pocketbase pocketbase-gogen presentator jsonschema goPocJsonSchemaForm; do \
		if [ -d "$$dir" ]; then \
			echo "=== $$dir ==="; \
			cd $$dir && git status --short && git log --oneline -1 && cd ..; \
			echo ""; \
		fi; \
	done
